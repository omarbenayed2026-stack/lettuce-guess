// --- TRANSLATIONS (Fully translated UI & Funny Texts) ---
const translations = {
    en: { 
        brand: "Lettuce Guess", 
        welcome: "Lettuce find something to prepare! ü•¨",
        seoIntro: "Welcome to the ultimate random recipe generator. We help students and lazy cooks find delicious, budget-friendly meals. Just set your preferences and let our algorithm decide your dinner!",
        togglePrefs: "‚öôÔ∏è Toggle Preferences",
        customize: "Customize Your Craving",
        studentFriendly: "Student Friendly", 
        cheap: "Cheap (< 6 DT) ü™ô", 
        expensive: "Expensive üí∞", 
        tunisianStyle: "Tunisian Style üáπüá≥",
        asianStyle: "Asian ü•¢",
        withChicken: "With Chicken üêî",
        fish: "Fish üêü",
        fried: "Fried üçü",
        vegan: "Vegan üå±",
        discover: "Discover", 
        dailyPick: "Dinner of the Day",
        lazyMode: "üü¢ Lazy Mode",
        lazyHint: "Fast, cheap, microwave-friendly.",
        chefMode: "üî¥ Chef Mode",
        chefHint: "Use the stove, impress your friends.",
        ingredients: "Ingredients & Spices",
        steps: "Instructions",
        footerText: "Helping students eat better, one click at a time.",
        funnyTexts: [
            "Checking your wallet...",
            "Saving you from eating plain pasta...",
            "Calculating student budget...",
            "Consulting the recipe algorithms...",
            "Finding something you won't burn...",
            "Looking for cheap ingredients..."
        ]
    },
    fr: { 
        brand: "Lettuce Guess", 
        welcome: "Trouvons quelque chose √† pr√©parer ! ü•¨",
        seoIntro: "Le g√©n√©rateur de recettes pour √©tudiants. Choisissez vos pr√©f√©rences et laissez l'algorithme d√©cider de votre d√Æner !",
        togglePrefs: "‚öôÔ∏è Pr√©f√©rences",
        customize: "Personnalisez",
        studentFriendly: "Pour √âtudiant", 
        cheap: "Pas Cher (< 6 DT) ü™ô", 
        expensive: "Cher üí∞", 
        tunisianStyle: "Style Tunisien üáπüá≥",
        asianStyle: "Asiatique ü•¢",
        withChicken: "Poulet üêî",
        fish: "Poisson üêü",
        fried: "Frit üçü",
        vegan: "V√©gan üå±",
        discover: "D√©couvrir", 
        dailyPick: "Plat du Jour",
        lazyMode: "üü¢ Mode Fain√©ant",
        lazyHint: "Rapide, pas cher, micro-ondes.",
        chefMode: "üî¥ Mode Chef",
        chefHint: "Cuisinez s√©rieusement, impressionnez vos amis.",
        ingredients: "Ingr√©dients & √âpices",
        steps: "Instructions",
        footerText: "Aider les √©tudiants √† mieux manger, un clic √† la fois.",
        funnyTexts: [
            "V√©rification de votre portefeuille...",
            "On vous sauve des p√¢tes natures...",
            "Calcul du budget √©tudiant...",
            "Consultation de l'algorithme...",
            "Recherche d'un plat impossible √† br√ªler...",
            "Recherche d'ingr√©dients pas chers..."
        ]
    },
    ar: { 
        brand: "Lettuce Guess", 
        welcome: "Lettuce Guess ÿ≥ŸäÿÆÿ™ÿßÿ± ŸÑŸÉ ŸÖÿßÿ∞ÿß ÿ™ÿ∑ÿ®ÿÆ! ü•¨",
        seoIntro: "ÿ£ŸÅÿ∂ŸÑ ŸÖŸàŸÇÿπ ŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ ŸàÿµŸÅÿßÿ™ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ® ŸàÿßŸÑÿ∑Ÿáÿßÿ© ÿßŸÑŸÉÿ≥ÿßŸÑŸâ. ÿ≠ÿØÿØ ŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉ ŸàÿØÿπ ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿ™ÿÆÿ™ÿßÿ± ÿπÿ¥ÿßÿ°ŸÉ!",
        togglePrefs: "‚öôÔ∏è ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™",
        customize: "ÿÆÿµÿµ ÿ±ÿ∫ÿ®ÿßÿ™ŸÉ",
        studentFriendly: "ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑÿ∑ŸÑÿßÿ®", 
        cheap: "ÿ±ÿÆŸäÿµ (ÿ£ŸÇŸÑ ŸÖŸÜ 6 ÿØ.ÿ™) ü™ô", 
        expensive: "ŸÖŸÉŸÑŸÅ üí∞", 
        tunisianStyle: "ÿ™ŸàŸÜÿ≥Ÿä üáπüá≥",
        asianStyle: "ÿ¢ÿ≥ŸäŸàŸä ü•¢",
        withChicken: "ÿ®ÿßŸÑÿØÿ¨ÿßÿ¨ üêî",
        fish: "ÿ≥ŸÖŸÉ üêü",
        fried: "ŸÖŸÇŸÑŸäÿ© üçü",
        vegan: "ŸÜÿ®ÿßÿ™Ÿä üå±",
        discover: "ÿßŸÉÿ™ÿ¥ŸÅ ÿ∑ÿπÿßŸÖŸÉ", 
        dailyPick: "ÿ∑ÿ®ŸÇ ÿßŸÑŸäŸàŸÖ",
        lazyMode: "üü¢ Ÿàÿ∂ÿπ ÿßŸÑŸÉÿ≥ŸÑ",
        lazyHint: "ÿ≥ÿ±Ÿäÿπÿå ÿ±ÿÆŸäÿµÿå ŸàŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑŸÖŸäŸÉÿ±ŸàŸàŸäŸÅ.",
        chefMode: "üî¥ Ÿàÿ∂ÿπ ÿßŸÑÿ∑ÿßŸáŸä",
        chefHint: "ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖŸàŸÇÿØ Ÿàÿ£ÿ®Ÿáÿ± ÿ£ÿµÿØŸÇÿßÿ°ŸÉ.",
        ingredients: "ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸàÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™",
        steps: "ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±",
        footerText: "ŸÜÿ≥ÿßÿπÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿπŸÑŸâ ÿ™ŸÜÿßŸàŸÑ ÿ∑ÿπÿßŸÖ ÿ£ŸÅÿ∂ŸÑ ÿ®ÿ∂ÿ∫ÿ∑ÿ© ÿ≤ÿ±.",
        funnyTexts: [
            "ÿ¨ÿßÿ±Ÿä ŸÅÿ≠ÿµ ŸÖÿ≠ŸÅÿ∏ÿ™ŸÉ...",
            "ŸÜŸÜŸÇÿ∞ŸÉ ŸÖŸÜ ÿ£ŸÉŸÑ ÿßŸÑŸÖŸÉÿ±ŸàŸÜÿ© ÿßŸÑÿ≥ÿßÿØÿ©...",
            "ÿ¨ÿßÿ±Ÿä ÿ≠ÿ≥ÿßÿ® ŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑÿ∑ÿßŸÑÿ®...",
            "ŸÜÿ™ÿ¥ÿßŸàÿ± ŸÖÿπ ÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© ÿßŸÑÿ∑ÿ®ÿÆ...",
            "ŸÜÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¥Ÿäÿ° ŸÑŸÜ ÿ™ÿ≠ÿ±ŸÇŸá...",
            "ŸÜÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÉŸàŸÜÿßÿ™ ÿ±ÿÆŸäÿµÿ©..."
        ]
    }
};


// --- THE MASTER DATABASE (Fully Translated in EN, FR, AR) ---
const foodDatabase = [
    { 
        id: "tun_1", tags: ["fried", "fish", "student", "tunisian", "cheap"], emoji: "ü•ü", difficultyCSS: "medium", 
        translations: {
            en: { 
                name: "Tunisian Brika", origin: "Tunisia", difficulty: "Medium", cost: "Est. 3.00 DT", 
                description: "A perfectly crispy triangle pastry, stuffed with tuna, parsley, and a runny egg.", 
                simple: { time: "10 mins", temp: "Medium-High (Stove)", ingredients: ["1 Malsouka sheet", "Canned Tuna", "1 Egg", "Chopped Parsley & Onion", "Pinch of Black Pepper & Salt"], steps: ["Mix tuna, parsley, onion, salt, and black pepper.", "Place the mixture on the Malsouka sheet and make a small hole in the middle.", "Crack the egg into the hole.", "Fold into a triangle quickly and fry in hot oil for 2-3 mins per side until golden."] }, 
                hard: { time: "25 mins", temp: "Medium-High", ingredients: ["Malsouka", "Tuna", "Capers", "Boiled Potato", "1 Egg", "Black Pepper", "Tabil (Tunisian Spice)"], steps: ["Boil and mash 1 potato. Mix it with a pinch of Tabil, black pepper, tuna, and capers.", "Spread the filling on the sheet, crack the egg inside.", "Fold into a triangle and fry in hot oil until deeply crispy."] } 
            },
            fr: { 
                name: "Brik Tunisien", origin: "Tunisie", difficulty: "Moyen", cost: "Env. 3.00 DT", 
                description: "Un triangle de p√¢te croustillante, farci au thon, persil et un ≈ìuf coulant.", 
                simple: { time: "10 mins", temp: "Feu Vif", ingredients: ["1 Feuille de Malsouka", "Thon", "1 ≈íuf", "Persil et oignon hach√©s", "Sel & Poivre"], steps: ["M√©langer thon, persil, oignon et √©pices.", "Placer sur la feuille, faire un creux.", "Casser l'≈ìuf dedans.", "Plier en triangle et frire 2-3 mins par face."] }, 
                hard: { time: "25 mins", temp: "Feu Vif", ingredients: ["Malsouka", "Thon", "C√¢pres", "Pomme de terre", "1 ≈íuf", "Poivre", "Tabel"], steps: ["√âcraser la pomme de terre bouillie, m√©langer avec Tabel, thon et c√¢pres.", "Placer la farce, ajouter l'≈ìuf.", "Frire dans l'huile bien chaude."] } 
            },
            ar: { 
                name: "ÿ®ÿ±ŸäŸÉ ÿ™ŸàŸÜÿ≥Ÿä", origin: "ÿ™ŸàŸÜÿ≥", difficulty: "ŸÖÿ™Ÿàÿ≥ÿ∑", cost: "ÿ≠ŸàÿßŸÑŸä 3.00 ÿØ.ÿ™", 
                description: "ŸÖÿ´ŸÑÿ´ ÿπÿ¨ŸäŸÜ ŸÖŸÇÿ±ŸÖÿ¥ ŸÖÿ≠ÿ¥Ÿà ÿ®ÿßŸÑÿ™ŸàŸÜÿ©ÿå ÿßŸÑÿ®ŸÇÿØŸàŸÜÿ≥ÿå Ÿàÿ®Ÿäÿ∂ÿ© ÿ≥ÿßÿ¶ŸÑÿ©.", 
                simple: { time: "10 ÿØŸÇÿßÿ¶ŸÇ", temp: "ŸÜÿßÿ± ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©-ÿπÿßŸÑŸäÿ©", ingredients: ["Ÿàÿ±ŸÇÿ© ŸÖŸÑÿ≥ŸàŸÇÿ©", "ÿ™ŸàŸÜÿ©", "ÿ®Ÿäÿ∂ÿ©", "ÿ®ŸÇÿØŸàŸÜÿ≥ Ÿàÿ®ÿµŸÑ ŸÖŸÇÿ∑ÿπ", "ŸÖŸÑÿ≠ ŸàŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØ"], steps: ["ÿßÿÆŸÑÿ∑ ÿßŸÑÿ™ŸàŸÜÿ©ÿå ÿßŸÑÿ®ŸÇÿØŸàŸÜÿ≥ÿå ÿßŸÑÿ®ÿµŸÑÿå ŸàÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™.", "ÿ∂ÿπ ÿßŸÑÿÆŸÑŸäÿ∑ ÿπŸÑŸâ ÿßŸÑŸÖŸÑÿ≥ŸàŸÇÿ© ŸàÿßÿµŸÜÿπ ÿ≠ŸÅÿ±ÿ© ÿµÿ∫Ÿäÿ±ÿ©.", "ÿßŸÉÿ≥ÿ± ÿßŸÑÿ®Ÿäÿ∂ÿ© ÿØÿßÿÆŸÑ ÿßŸÑÿ≠ŸÅÿ±ÿ©.", "ÿßÿ∑ŸàŸáÿß ÿπŸÑŸâ ÿ¥ŸÉŸÑ ŸÖÿ´ŸÑÿ´ ŸàÿßŸÇŸÑŸäŸáÿß ŸÅŸä ÿ≤Ÿäÿ™ ÿ≥ÿßÿÆŸÜ ÿ≠ÿ™Ÿâ ÿ™ÿµÿ®ÿ≠ ÿ∞Ÿáÿ®Ÿäÿ©."] }, 
                hard: { time: "25 ÿØŸÇŸäŸÇÿ©", temp: "ŸÜÿßÿ± ÿπÿßŸÑŸäÿ©", ingredients: ["ŸÖŸÑÿ≥ŸàŸÇÿ©", "ÿ™ŸàŸÜÿ©", "ŸÉŸéÿ®Ÿéÿ±", "ÿ®ÿ∑ÿßÿ∑ÿß ŸÖÿ≥ŸÑŸàŸÇÿ©", "ÿ®Ÿäÿ∂ÿ©", "ŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØ", "ÿ™ÿßÿ®ŸÑ ŸàŸÉÿ±ŸàŸäÿ©"], steps: ["ÿßÿ≥ŸÑŸÇ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿß ŸàÿßŸáÿ±ÿ≥Ÿáÿßÿå ÿßÿÆŸÑÿ∑Ÿáÿß ŸÖÿπ ÿßŸÑÿ™ÿßÿ®ŸÑ ŸàÿßŸÑÿ™ŸàŸÜÿ© ŸàÿßŸÑŸÉÿ®ÿ±.", "ÿ∂ÿπ ÿßŸÑÿ≠ÿ¥Ÿàÿ© ŸàÿßŸÑÿ®Ÿäÿ∂ÿ© ÿπŸÑŸâ ÿßŸÑŸàÿ±ŸÇÿ©.", "ÿßŸÇŸÑŸäŸáÿß ŸÅŸä ÿ≤Ÿäÿ™ ÿ≥ÿßÿÆŸÜ ÿ¨ÿØÿßŸã ÿ≠ÿ™Ÿâ ÿ™ŸÇÿ±ŸÖÿ¥."] } 
            }
        }
    },
    { 
        id: "tun_2", tags: ["boiled", "student", "spicy", "vegan", "tunisian", "cheap"], emoji: "ü•£", difficultyCSS: "easy", 
        translations: {
            en: { 
                name: "Spicy Lablebi", origin: "Tunisia", difficulty: "Easy", cost: "Est. 3.50 DT", 
                description: "The ultimate cheap, garlicky chickpea street-food soup poured over day-old bread.", 
                simple: { time: "15 mins", temp: "Boiling", ingredients: ["1 Can Chickpeas", "1 tbsp Harissa", "Stale Baguette", "2 cloves Garlic (crushed)", "1 tsp Cumin", "Olive Oil"], steps: ["Boil chickpeas in their water with crushed garlic, cumin, and salt for 10 minutes.", "Tear the stale bread into small pieces in a bowl.", "Pour the boiling soup over the bread. Top with Harissa, olive oil, and extra cumin."] }, 
                hard: { time: "2 hours", temp: "Low Simmer", ingredients: ["Dried Chickpeas", "Garlic", "Harissa", "Olive Oil", "Cumin", "Canned Tuna", "1 Soft-Boiled Egg"], steps: ["Soak chickpeas overnight. Boil them for 2 hours until very soft.", "Prepare a bowl with torn bread.", "Add the hot chickpeas and broth. Top heavily with olive oil, cumin, Harissa, tuna, and mix the soft-boiled egg in."] } 
            },
            fr: { 
                name: "Lablebi √âpic√©", origin: "Tunisie", difficulty: "Facile", cost: "Env. 3.50 DT", 
                description: "Soupe de rue pas ch√®re aux pois chiches et √† l'ail, vers√©e sur du pain de la veille.", 
                simple: { time: "15 mins", temp: "√âbullition", ingredients: ["Pois chiches en bo√Æte", "Harissa", "Pain rassis", "Ail", "Cumin", "Huile d'olive"], steps: ["Bouillir les pois chiches avec l'ail et le cumin 10 mins.", "D√©chirer le pain dans un bol.", "Verser la soupe br√ªlante. Ajouter harissa et huile d'olive."] }, 
                hard: { time: "2 heures", temp: "Fr√©mir", ingredients: ["Pois chiches secs", "Ail", "Harissa", "Huile d'olive", "Cumin", "Thon", "≈íuf mollet"], steps: ["Tremper les pois chiches la nuit. Bouillir 2h.", "Mettre le pain dans un bol.", "Ajouter pois chiches, bouillon, huile, cumin, harissa, thon et l'≈ìuf."] } 
            },
            ar: { 
                name: "ŸÑÿ®ŸÑÿßÿ®Ÿä ÿ≠ÿßÿ±", origin: "ÿ™ŸàŸÜÿ≥", difficulty: "ÿ≥ŸáŸÑ", cost: "ÿ≠ŸàÿßŸÑŸä 3.50 ÿØ.ÿ™", 
                description: "ÿ≠ÿ≥ÿßÿ° ÿßŸÑÿ¥ÿßÿ±ÿπ ÿßŸÑÿ¥ŸáŸäÿ± ŸàÿßŸÑÿ±ÿÆŸäÿµ ÿ®ÿßŸÑÿ≠ŸÖÿµ ŸàÿßŸÑÿ´ŸàŸÖÿå ŸäŸèÿ≥ŸÉÿ® ŸÅŸàŸÇ ÿßŸÑÿÆÿ®ÿ≤ ÿßŸÑÿ®ÿßÿ¶ÿ™.", 
                simple: { time: "15 ÿØŸÇŸäŸÇÿ©", temp: "ÿ∫ŸÑŸäÿßŸÜ", ingredients: ["ÿ≠ŸÖÿµ ŸÖÿπŸÑÿ®", "ŸÖŸÑÿπŸÇÿ© Ÿáÿ±Ÿäÿ≥ÿ©", "ÿÆÿ®ÿ≤ ÿ®ÿßÿ¶ÿ™", "ÿ´ŸàŸÖ ŸÖŸáÿ±Ÿàÿ≥", "ŸÉŸÖŸàŸÜ", "ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ"], steps: ["ÿßÿ∫ŸÑŸä ÿßŸÑÿ≠ŸÖÿµ ŸÅŸä ŸÖÿßÿ¶Ÿá ŸÖÿπ ÿßŸÑÿ´ŸàŸÖ ŸàÿßŸÑŸÉŸÖŸàŸÜ ŸàÿßŸÑŸÖŸÑÿ≠ ŸÑŸÄ 10 ÿØŸÇÿßÿ¶ŸÇ.", "ŸÇÿ∑ÿπ ÿßŸÑÿÆÿ®ÿ≤ ÿßŸÑÿ®ÿßÿ¶ÿ™ ŸÅŸä Ÿàÿπÿßÿ°.", "ÿßÿ≥ŸÉÿ® ÿßŸÑÿ≠ÿ≥ÿßÿ° ÿßŸÑŸÖÿ∫ŸÑŸä ŸÅŸàŸÇ ÿßŸÑÿÆÿ®ÿ≤ Ÿàÿ≤ŸäŸÜŸá ÿ®ÿßŸÑŸáÿ±Ÿäÿ≥ÿ© Ÿàÿ≤Ÿäÿ™ ÿßŸÑÿ≤Ÿäÿ™ŸàŸÜ."] }, 
                hard: { time: "ÿ≥ÿßÿπÿ™ÿßŸÜ", temp: "ŸÜÿßÿ± ŸáÿßÿØÿ¶ÿ©", ingredients: ["ÿ≠ŸÖÿµ ÿ¨ÿßŸÅ", "ÿ´ŸàŸÖ", "Ÿáÿ±Ÿäÿ≥ÿ©", "ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ", "ŸÉŸÖŸàŸÜ", "ÿ™ŸàŸÜÿ©", "ÿ®Ÿäÿ∂ÿ© ŸÜÿµŸÅ ŸÖÿ≥ŸÑŸàŸÇÿ©"], steps: ["ÿßŸÜŸÇÿπ ÿßŸÑÿ≠ŸÖÿµ ÿ∑ŸàÿßŸÑ ÿßŸÑŸÑŸäŸÑ Ÿàÿßÿ∫ŸÑŸá ŸÑÿ≥ÿßÿπÿ™ŸäŸÜ ÿ≠ÿ™Ÿâ ŸäŸÑŸäŸÜ ÿ¨ÿØÿßŸã.", "ÿ≠ÿ∂ÿ± Ÿàÿπÿßÿ° ÿßŸÑÿÆÿ®ÿ≤ ÿßŸÑŸÖŸÇÿ∑ÿπ.", "ÿ£ÿ∂ŸÅ ÿßŸÑÿ≠ŸÖÿµ ŸàÿßŸÑŸÖÿ±ŸÇÿå Ÿàÿ≤ŸäŸÜŸá ÿ®ÿ≥ÿÆÿßÿ° ÿ®ÿ≤Ÿäÿ™ ÿßŸÑÿ≤Ÿäÿ™ŸàŸÜ ŸàÿßŸÑŸÉŸÖŸàŸÜ ŸàÿßŸÑŸáÿ±Ÿäÿ≥ÿ© ŸàÿßŸÑÿ™ŸàŸÜÿ© ŸàÿßŸÑÿ®Ÿäÿ∂ÿ©."] } 
            }
        }
    },
    { 
        id: "tun_3", tags: ["boiled", "tunisian", "expensive"], emoji: "ü•ò", difficultyCSS: "hard", 
        translations: {
            en: { 
                name: "Traditional Mloukhiya", origin: "Tunisia", difficulty: "Hard", cost: "Est. 25.00 DT", 
                description: "A rich, dark green stew simmered for hours, made with jute leaf powder and tender beef.", 
                simple: { time: "3.5 hours", temp: "Low Heat", ingredients: ["Mloukhiya powder", "Olive Oil", "Beef chunks", "Minced Garlic", "Bay Leaves", "Tabil & Karwia"], steps: ["Mix the green powder with olive oil in a cold pot until it forms a paste.", "Turn on medium heat, gradually whisk in 1.5 liters of boiling water.", "Add garlic, bay leaves, Tabil, and beef.", "Cover and simmer on very low heat for 3 hours until the oil separates."] }, 
                hard: { time: "5 hours", temp: "Lowest Heat", ingredients: ["Mloukhiya powder", "Premium Olive Oil", "Beef Shank", "Whole Head of Garlic", "Dried Mint", "Tabil & Karwia", "Bay Leaves"], steps: ["Marinate beef overnight with garlic, Tabil, Karwia, and salt.", "Fry the powder in olive oil for 3 minutes (do not burn).", "Whisk in boiling water.", "Simmer for 2 hours, add beef. Cook 3 more hours until oil separates."] } 
            },
            fr: { 
                name: "Mloukhiya Traditionnelle", origin: "Tunisie", difficulty: "Difficile", cost: "Env. 25.00 DT", 
                description: "Rago√ªt vert fonc√© riche, mijot√© pendant des heures avec de la poudre de cor√®te et du b≈ìuf.", 
                simple: { time: "3.5 heures", temp: "Feu Doux", ingredients: ["Poudre de Mloukhiya", "Huile d'olive", "B≈ìuf", "Ail", "Laurier", "Tabel & Karwia"], steps: ["M√©langer la poudre et l'huile √† froid.", "Chauffer et ajouter l'eau bouillante.", "Ajouter ail, √©pices et viande.", "Mijoter √† feu tr√®s doux 3h jusqu'√† ce que l'huile remonte."] }, 
                hard: { time: "5 heures", temp: "Feu Tr√®s Doux", ingredients: ["Mloukhiya", "Huile d'olive", "Jarret de b≈ìuf", "Ail", "Menthe s√©ch√©e", "Tabel & Karwia", "Laurier"], steps: ["Mariner la viande la nuit avec les √©pices.", "Frire la poudre dans l'huile 3 mins.", "Ajouter l'eau bouillante doucement.", "Mijoter 2h, ajouter la viande. Cuire encore 3h."] } 
            },
            ar: { 
                name: "ŸÖŸÑŸàÿÆŸäÿ© ÿØŸäÿßÿ±Ÿä", origin: "ÿ™ŸàŸÜÿ≥", difficulty: "ÿµÿπÿ®", cost: "ÿ≠ŸàÿßŸÑŸä 25.00 ÿØ.ÿ™", 
                description: "ŸäÿÆŸÜÿ© ÿ∫ŸÜŸäÿ© ŸàÿØÿßŸÉŸÜÿ© ÿ™Ÿèÿ∑ÿ®ÿÆ ŸÑÿ≥ÿßÿπÿßÿ™ ŸÖŸÜ ŸÖÿ≥ÿ≠ŸàŸÇ ÿßŸÑŸÖŸÑŸàÿÆŸäÿ© ŸàŸÑÿ≠ŸÖ ÿßŸÑÿ®ŸÇÿ± ÿßŸÑÿ∑ÿ±Ÿä.", 
                simple: { time: "3.5 ÿ≥ÿßÿπÿßÿ™", temp: "ŸÜÿßÿ± ŸáÿßÿØÿ¶ÿ©", ingredients: ["ŸÖÿ≥ÿ≠ŸàŸÇ ŸÖŸÑŸàÿÆŸäÿ©", "ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ", "ŸÇÿ∑ÿπ ŸÑÿ≠ŸÖ ÿ®ŸÇÿ±", "ÿ´ŸàŸÖ", "ÿ±ŸÜÿØ (ÿ∫ÿßÿ±)", "ÿ™ÿßÿ®ŸÑ ŸàŸÉÿ±ŸàŸäÿ©"], steps: ["ÿßÿÆŸÑÿ∑ ÿßŸÑŸÖÿ≥ÿ≠ŸàŸÇ ŸÖÿπ ÿßŸÑÿ≤Ÿäÿ™ ŸÅŸä ŸÇÿØÿ± ÿ®ÿßÿ±ÿØ.", "ÿ≥ÿÆŸÜ ÿßŸÑŸÇÿØÿ± Ÿàÿ£ÿ∂ŸÅ ÿßŸÑŸÖÿßÿ° ÿßŸÑŸÖÿ∫ŸÑŸä ÿ™ÿØÿ±Ÿäÿ¨ŸäÿßŸã.", "ÿ£ÿ∂ŸÅ ÿßŸÑÿ´ŸàŸÖ ŸàÿßŸÑÿ±ŸÜÿØ ŸàÿßŸÑŸÑÿ≠ŸÖ.", "ÿßÿ™ÿ±ŸÉŸáÿß ÿ™ÿ∑ÿ®ÿÆ ÿπŸÑŸâ ŸÜÿßÿ± ŸáÿßÿØÿ¶ÿ© ÿ¨ÿØÿßŸã ŸÑŸÄ 3 ÿ≥ÿßÿπÿßÿ™ ÿ≠ÿ™Ÿâ Ÿäÿ∑ŸÅŸà ÿßŸÑÿ≤Ÿäÿ™."] }, 
                hard: { time: "5 ÿ≥ÿßÿπÿßÿ™", temp: "ŸÜÿßÿ± ŸáÿßÿØÿ¶ÿ© ÿ¨ÿØÿßŸã", ingredients: ["ŸÖŸÑŸàÿÆŸäÿ©", "ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ ÿ±ŸÅŸäÿπ", "ŸÑÿ≠ŸÖ ÿ®ŸÇÿ± (Ÿáÿ®ÿ±ÿ©)", "ÿ±ÿ£ÿ≥ ÿ´ŸàŸÖ ŸÉÿßŸÖŸÑ", "ŸÜÿπŸÜÿßÿπ ÿ¥ÿßŸäÿ≠", "ÿ™ÿßÿ®ŸÑ ŸàŸÉÿ±ŸàŸäÿ©", "ÿ±ŸÜÿØ"], steps: ["ÿ™ÿ®ŸÑ ÿßŸÑŸÑÿ≠ŸÖ ŸÑŸäŸÑÿ© ŸÉÿßŸÖŸÑÿ© ÿ®ÿßŸÑÿ´ŸàŸÖ ŸàÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™.", "ÿßŸÇŸÑŸê ÿßŸÑŸÖŸÑŸàÿÆŸäÿ© ŸÅŸä ÿßŸÑÿ≤Ÿäÿ™ ŸÑŸÄ 3 ÿØŸÇÿßÿ¶ŸÇ.", "ÿ£ÿ∂ŸÅ ÿßŸÑŸÖÿßÿ° ÿßŸÑŸÖÿ∫ŸÑŸä ŸÖÿπ ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÖÿ≥ÿ™ŸÖÿ±.", "ÿßÿ∑ÿ®ÿÆŸáÿß ŸÑÿ≥ÿßÿπÿ™ŸäŸÜ ÿ´ŸÖ ÿ£ÿ∂ŸÅ ÿßŸÑŸÑÿ≠ŸÖ. ÿßÿ™ÿ±ŸÉŸáÿß 3 ÿ≥ÿßÿπÿßÿ™ ÿ£ÿÆÿ±Ÿâ ÿ≠ÿ™Ÿâ ŸäŸÇÿ± ÿ≤Ÿäÿ™Ÿáÿß."] } 
            }
        }
    },
    { 
        id: "int_5", tags: ["student", "boiled", "cheap"], emoji: "üçù", difficultyCSS: "medium", 
        translations: {
            en: { 
                name: "Garlic Butter Pasta", origin: "Italy", difficulty: "Medium", cost: "Est. 4.00 DT", 
                description: "A 5-star tasting meal made from standard, cheap pantry ingredients.", 
                simple: { time: "15 mins", temp: "Boiling", ingredients: ["Spaghetti", "2 tbsp Butter", "1 tsp Garlic Powder", "Salt & Black Pepper", "Grated Cheese"], steps: ["Boil water, add salt, and cook pasta for 10 mins. Drain it.", "In the same hot pot, melt butter, add garlic powder and black pepper.", "Toss the pasta in the butter, top with cheese."] }, 
                hard: { time: "20 mins", temp: "Medium Heat", ingredients: ["Spaghetti", "Real Butter", "4 cloves Fresh Garlic", "Fresh Parsley", "Chili Flakes", "Parmesan Cheese"], steps: ["Cook pasta, save half a cup of pasta water.", "In a pan, melt butter. Saut√© fresh minced garlic and chili flakes for 2 mins.", "Add pasta and the saved water. Toss vigorously until a creamy sauce forms. Top with parsley."] } 
            },
            fr: { 
                name: "P√¢tes Beurre et Ail", origin: "Italie", difficulty: "Moyen", cost: "Env. 4.00 DT", 
                description: "Un repas 5 √©toiles r√©alis√© avec des ingr√©dients simples et pas chers.", 
                simple: { time: "15 mins", temp: "√âbullition", ingredients: ["Spaghetti", "Beurre", "Ail en poudre", "Sel & Poivre", "Fromage r√¢p√©"], steps: ["Cuire les p√¢tes 10 mins et √©goutter.", "Fondre le beurre dans la casserole avec l'ail en poudre.", "M√©langer les p√¢tes et ajouter le fromage."] }, 
                hard: { time: "20 mins", temp: "Feu Moyen", ingredients: ["Spaghetti", "Beurre", "Ail frais", "Persil", "Piment en flocons", "Parmesan"], steps: ["Cuire les p√¢tes, garder un peu d'eau de cuisson.", "Fondre le beurre, sauter l'ail et le piment 2 mins.", "Ajouter les p√¢tes et l'eau. M√©langer fort pour cr√©er une sauce cr√©meuse."] } 
            },
            ar: { 
                name: "ŸÖŸÉÿ±ŸàŸÜÿ© ÿ®ÿßŸÑÿ´ŸàŸÖ ŸàÿßŸÑÿ≤ÿ®ÿØÿ©", origin: "ÿ•Ÿäÿ∑ÿßŸÑŸäÿß", difficulty: "ŸÖÿ™Ÿàÿ≥ÿ∑", cost: "ÿ≠ŸàÿßŸÑŸä 4.00 ÿØ.ÿ™", 
                description: "Ÿàÿ¨ÿ®ÿ© ÿ®ŸÖÿ∞ÿßŸÇ 5 ŸÜÿ¨ŸàŸÖ ÿ®ŸÖŸÉŸàŸÜÿßÿ™ ÿ±ÿÆŸäÿµÿ© ŸàŸÖÿ™ŸàŸÅÿ±ÿ© ŸÅŸä ŸÉŸÑ ŸÖÿ∑ÿ®ÿÆ.", 
                simple: { time: "15 ÿØŸÇŸäŸÇÿ©", temp: "ÿ∫ŸÑŸäÿßŸÜ", ingredients: ["ÿ≥ÿ®ÿßÿ∫Ÿäÿ™Ÿä", "ÿ≤ÿ®ÿØÿ©", "ÿ®ŸàÿØÿ±ÿ© ÿ´ŸàŸÖ", "ŸÖŸÑÿ≠ ŸàŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØ", "ÿ¨ÿ®ŸÜ ŸÖÿ®ÿ¥Ÿàÿ±"], steps: ["ÿßÿ≥ŸÑŸÇ ÿßŸÑŸÖŸÉÿ±ŸàŸÜÿ© ŸÑŸÄ 10 ÿØŸÇÿßÿ¶ŸÇ ŸàÿµŸÅŸáÿß.", "ŸÅŸä ŸÜŸÅÿ≥ ÿßŸÑŸÇÿØÿ±ÿå ÿ£ÿ∞ÿ® ÿßŸÑÿ≤ÿ®ÿØÿ© Ÿàÿ£ÿ∂ŸÅ ÿ®ŸàÿØÿ±ÿ© ÿßŸÑÿ´ŸàŸÖ ŸàÿßŸÑŸÅŸÑŸÅŸÑ.", "ŸÇŸÑÿ® ÿßŸÑŸÖŸÉÿ±ŸàŸÜÿ© ŸÅŸä ÿßŸÑÿ≤ÿ®ÿØÿ© Ÿàÿ≤ŸäŸÜŸáÿß ÿ®ÿßŸÑÿ¨ÿ®ŸÜ."] }, 
                hard: { time: "20 ÿØŸÇŸäŸÇÿ©", temp: "ŸÜÿßÿ± ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©", ingredients: ["ÿ≥ÿ®ÿßÿ∫Ÿäÿ™Ÿä", "ÿ≤ÿ®ÿØÿ© ÿ≠ŸäŸàÿßŸÜŸäÿ©", "ÿ´ŸàŸÖ ÿ∑ÿßÿ≤ÿ¨", "ÿ®ŸÇÿØŸàŸÜÿ≥ ÿ∑ÿßÿ≤ÿ¨", "ÿ±ŸÇÿßÿ¶ŸÇ ŸÅŸÑŸÅŸÑ ÿ≠ÿßÿ±", "ÿ¨ÿ®ŸÜ ÿ®ÿßÿ±ŸÖŸäÿ≤ÿßŸÜ"], steps: ["ÿßÿ≥ŸÑŸÇ ÿßŸÑŸÖŸÉÿ±ŸàŸÜÿ© Ÿàÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ŸÜÿµŸÅ ŸÉŸàÿ® ŸÖŸÜ ŸÖÿßÿ° ÿßŸÑÿ≥ŸÑŸÇ.", "ÿ£ÿ∞ÿ® ÿßŸÑÿ≤ÿ®ÿØÿ© Ÿàÿ¥ŸàŸëÿ≠ ÿßŸÑÿ´ŸàŸÖ ÿßŸÑÿ∑ÿßÿ≤ÿ¨ ŸàÿßŸÑŸÅŸÑŸÅŸÑ ŸÑŸÄ ÿØŸÇŸäŸÇÿ™ŸäŸÜ.", "ÿ£ÿ∂ŸÅ ÿßŸÑŸÖŸÉÿ±ŸàŸÜÿ© ŸàŸÖÿßÿ° ÿßŸÑÿ≥ŸÑŸÇ. ŸÇŸÑÿ® ÿ®ŸÇŸàÿ© ÿ≠ÿ™Ÿâ ÿ™ÿ™ŸÉŸàŸÜ ÿµŸÑÿµÿ© ŸÉÿ±ŸäŸÖŸäÿ©."] } 
            }
        }
    },
    { 
        id: "int_10", tags: ["chicken", "fried", "expensive"], emoji: "üçó", difficultyCSS: "hard", 
        translations: {
            en: { 
                name: "Spicy Fried Chicken", origin: "USA", difficulty: "Hard", cost: "Est. 18.00 DT", 
                description: "Golden, ultra-crispy fried chicken with heavy spices.", 
                simple: { time: "25 mins", temp: "High Heat", ingredients: ["Chicken Breasts", "Flour", "2 Eggs", "Paprika, Garlic Powder, Salt, Black Pepper", "Frying Oil"], steps: ["Cut chicken into chunks.", "Mix flour with a heavy amount of paprika, salt, and pepper.", "Dip chicken in beaten egg, then in spiced flour.", "Fry in 170¬∞C hot oil for 7-10 minutes until golden brown."] }, 
                hard: { time: "12 hours", temp: "160¬∞C Oil", ingredients: ["Bone-in Chicken pieces", "Lben (Buttermilk)", "Flour", "Cornstarch", "Red Chili Powder, Garlic, Onion, White Pepper"], steps: ["Marinate chicken overnight in Lben and hot sauce.", "Mix 2 parts flour, 1 part cornstarch, and spices.", "Dredge chicken in flour, pressing hard.", "Fry in deep oil for 12-15 minutes. Rest on a wire rack."] } 
            },
            fr: { 
                name: "Poulet Frit √âpic√©", origin: "USA", difficulty: "Difficile", cost: "Env. 18.00 DT", 
                description: "Poulet frit dor√© et ultra-croustillant avec beaucoup d'√©pices.", 
                simple: { time: "25 mins", temp: "Feu Vif", ingredients: ["Blancs de poulet", "Farine", "2 ≈íufs", "Paprika, Ail, Sel, Poivre", "Huile de friture"], steps: ["Couper le poulet.", "M√©langer farine et √©pices.", "Tremper le poulet dans l'≈ìuf puis la farine.", "Frire √† 170¬∞C pendant 7-10 mins."] }, 
                hard: { time: "12 heures", temp: "Huile 160¬∞C", ingredients: ["Poulet avec os", "Lben (Babeurre)", "Farine", "Ma√Øzena", "Piment rouge, Ail, Oignon, Poivre blanc"], steps: ["Mariner le poulet la nuit dans le Lben.", "M√©langer farine, ma√Øzena et √©pices.", "Enrober le poulet en pressant fort.", "Frire 12-15 mins. Laisser reposer sur une grille."] } 
            },
            ar: { 
                name: "ÿØÿ¨ÿßÿ¨ ŸÖŸÇŸÑŸä ÿ≠ÿßÿ±", origin: "ÿ£ŸÖÿ±ŸäŸÉÿß", difficulty: "ÿµÿπÿ®", cost: "ÿ≠ŸàÿßŸÑŸä 18.00 ÿØ.ÿ™", 
                description: "ÿØÿ¨ÿßÿ¨ ŸÖŸÇŸÑŸä ÿ∞Ÿáÿ®Ÿä ŸàŸÖŸÇÿ±ŸÖÿ¥ ÿ¨ÿØÿßŸã ŸàŸÖŸÑŸäÿ° ÿ®ÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™.", 
                simple: { time: "25 ÿØŸÇŸäŸÇÿ©", temp: "ŸÜÿßÿ± ÿπÿßŸÑŸäÿ©", ingredients: ["ÿµÿØŸàÿ± ÿØÿ¨ÿßÿ¨", "ÿØŸÇŸäŸÇ", "ÿ®Ÿäÿ∂ÿ™ÿßŸÜ", "ÿ®ÿßÿ®ÿ±ŸäŸÉÿßÿå ÿ®ŸàÿØÿ±ÿ© ÿ´ŸàŸÖÿå ŸÖŸÑÿ≠ÿå ŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØ", "ÿ≤Ÿäÿ™ ŸÇŸÑŸä"], steps: ["ŸÇÿ∑ÿπ ÿßŸÑÿØÿ¨ÿßÿ¨ ÿ•ŸÑŸâ ŸÇÿ∑ÿπ.", "ÿßÿÆŸÑÿ∑ ÿßŸÑÿØŸÇŸäŸÇ ŸÖÿπ ÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™.", "ÿßÿ∫ŸÖÿ≥ ÿßŸÑÿØÿ¨ÿßÿ¨ ŸÅŸä ÿßŸÑÿ®Ÿäÿ∂ ÿ´ŸÖ ŸÅŸä ÿßŸÑÿØŸÇŸäŸÇ ÿßŸÑŸÖÿ™ÿ®ŸÑ.", "ÿßŸÇŸÑŸá ŸÅŸä ÿ≤Ÿäÿ™ ÿ≥ÿßÿÆŸÜ (170 ÿØÿ±ÿ¨ÿ©) ŸÑŸÄ 7-10 ÿØŸÇÿßÿ¶ŸÇ."] }, 
                hard: { time: "12 ÿ≥ÿßÿπÿ©", temp: "ÿ≤Ÿäÿ™ 160 ÿØÿ±ÿ¨ÿ©", ingredients: ["ÿØÿ¨ÿßÿ¨ ÿ®ÿßŸÑÿπÿ∏ŸÖ", "ŸÑÿ®ŸÜ", "ÿØŸÇŸäŸÇ", "ŸÜÿ¥ÿß", "ŸÅŸÑŸÅŸÑ ÿ£ÿ≠ŸÖÿ± ÿ≠ÿßÿ±ÿå ÿ´ŸàŸÖÿå ÿ®ÿµŸÑÿå ŸÅŸÑŸÅŸÑ ÿ£ÿ®Ÿäÿ∂"], steps: ["ÿßŸÜŸÇÿπ ÿßŸÑÿØÿ¨ÿßÿ¨ ŸÑŸäŸÑÿ© ŸÉÿßŸÖŸÑÿ© ŸÅŸä ÿßŸÑŸÑÿ®ŸÜ ŸàÿßŸÑÿµŸÑÿµÿ© ÿßŸÑÿ≠ÿßÿ±ÿ©.", "ÿßÿÆŸÑÿ∑ ÿßŸÑÿØŸÇŸäŸÇ ŸàÿßŸÑŸÜÿ¥ÿß ŸàÿßŸÑÿ®Ÿáÿßÿ±ÿßÿ™.", "ÿ∫ŸÑŸÅ ÿßŸÑÿØÿ¨ÿßÿ¨ ÿ®ÿßŸÑÿÆŸÑŸäÿ∑ Ÿàÿßÿ∂ÿ∫ÿ∑ ÿ®ŸÇŸàÿ©.", "ÿßŸÇŸÑŸá ŸÅŸä ÿ≤Ÿäÿ™ ÿ∫ÿ≤Ÿäÿ± ŸÑŸÄ 12-15 ÿØŸÇŸäŸÇÿ©. ÿØÿπŸá Ÿäÿ±ÿ™ÿßÿ≠ ÿπŸÑŸâ ÿ¥ÿ®ŸÉÿ© ŸÖÿπÿØŸÜŸäÿ©."] } 
            }
        }
    }
];

let currentFood = null;
let currentLang = 'en';

// --- INITIALIZE THEME & LANGUAGE ---
window.onload = () => {
    if (localStorage.getItem('lettuceTheme') === 'dark') {
        document.body.classList.add('dark-theme');
        document.getElementById('themeToggleBtn').innerText = "‚òÄÔ∏è";
    }
    const savedLang = localStorage.getItem('lettuceLang') || 'en';
    document.getElementById('languageSelect').value = savedLang;
    applyLanguage(savedLang);
};

// --- TOP BAR CONTROLS ---
document.getElementById('themeToggleBtn').addEventListener('click', (e) => {
    document.body.classList.toggle('dark-theme');
    const isDark = document.body.classList.contains('dark-theme');
    e.target.innerText = isDark ? "‚òÄÔ∏è" : "üåô";
    localStorage.setItem('lettuceTheme', isDark ? 'dark' : 'light');
});

document.getElementById('languageSelect').addEventListener('change', (e) => {
    currentLang = e.target.value;
    localStorage.setItem('lettuceLang', currentLang);
    applyLanguage(currentLang);
    
    // Refresh food translation if a food is currently showing
    if (currentFood && document.getElementById('result').style.display !== 'none') {
        let prefix = "";
        if (document.getElementById('foodName').innerText.includes("üåü") || document.getElementById('foodName').innerText.includes("‚≠ê")) {
            prefix = `üåü ${translations[currentLang].dailyPick}: `;
        }
        showResultUI(prefix); 
        
        // Refresh Modal if it is open
        if (!document.getElementById('recipeModal').classList.contains('hidden')) {
            const isSimple = document.getElementById('modalTitle').innerText.includes("üü¢");
            window.openRecipeDetails(isSimple ? 'simple' : 'hard');
        }
    }
});

function applyLanguage(lang) {
    currentLang = lang;
    
    // 1. Update HTML text based on data-i18n attributes
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            // Keep emojis safe if they exist inside the innerHTML
            if(el.innerHTML.includes('ü™ô')) el.innerHTML = translations[lang][key];
            else if(el.innerHTML.includes('üí∞')) el.innerHTML = translations[lang][key];
            else if(el.innerHTML.includes('üéì')) el.innerHTML = "üéì " + translations[lang][key];
            else if(el.innerHTML.includes('üáπüá≥')) el.innerHTML = translations[lang][key] + " üáπüá≥";
            else if(el.innerHTML.includes('ü•¢')) el.innerHTML = translations[lang][key] + " ü•¢";
            else if(el.innerHTML.includes('üêî')) el.innerHTML = translations[lang][key] + " üêî";
            else if(el.innerHTML.includes('üêü')) el.innerHTML = translations[lang][key] + " üêü";
            else if(el.innerHTML.includes('üçü')) el.innerHTML = translations[lang][key] + " üçü";
            else if(el.innerHTML.includes('üå±')) el.innerHTML = translations[lang][key] + " üå±";
            else el.innerHTML = translations[lang][key]; 
        }
    });

    // 2. Set direction for CSS (This triggers the Tajawal font automatically now!)
    if (lang === 'ar') {
        document.body.setAttribute('dir', 'rtl');
    } else {
        document.body.setAttribute('dir', 'ltr');
    }
}

// --- UI LOGIC ---
document.getElementById('toggleFiltersBtn').addEventListener('click', () => {
    document.getElementById('preferencesPanel').classList.toggle('hidden');
});

// Daily Pick Button Logic
document.getElementById('dailyPickBtn').addEventListener('click', () => {
    const dateStr = new Date().toDateString(); 
    let hash = 0;
    for (let i = 0; i < dateStr.length; i++) hash = dateStr.charCodeAt(i) + ((hash << 5) - hash);
    currentFood = foodDatabase[Math.abs(hash) % foodDatabase.length];
    showResultUI(`üåü ${translations[currentLang].dailyPick}: `); 
});

// Main Discover Button Logic
document.getElementById('suggestBtn').addEventListener('click', () => {
    const filters = { 
        studentOnly: document.getElementById('studentOnly').checked,
        cheapOnly: document.getElementById('cheapOnly').checked,
        expensiveOnly: document.getElementById('expensiveOnly').checked,
        tunisianStyle: document.getElementById('tunisianStyle').checked, 
        asianStyle: document.getElementById('asianStyle').checked, 
        withChicken: document.getElementById('withChicken').checked, 
        loveFish: document.getElementById('loveFish').checked, 
        friedOnly: document.getElementById('friedOnly').checked, 
        isVegan: document.getElementById('vegan').checked 
    };

    let availableFood = foodDatabase.filter(food => {
        if (filters.studentOnly && !food.tags.includes('student')) return false; 
        if (filters.cheapOnly && !food.tags.includes('cheap')) return false;
        if (filters.expensiveOnly && !food.tags.includes('expensive')) return false;
        if (filters.tunisianStyle && !food.tags.includes('tunisian')) return false; 
        if (filters.asianStyle && !food.tags.includes('asian')) return false; 
        if (filters.withChicken && !food.tags.includes('chicken')) return false; 
        if (filters.loveFish && !food.tags.includes('fish')) return false;
        if (filters.friedOnly && !food.tags.includes('fried')) return false;
        if (filters.isVegan && !food.tags.includes('vegan')) return false;
        return true;
    });
    
    if (availableFood.length === 0) {
        alert("No food matches those exact filters! Try unchecking a few boxes.");
        return;
    }

    const btn = document.getElementById('suggestBtn');
    const loadingText = document.getElementById('funnyLoadingText');
    const resultSec = document.getElementById('result');
    
    btn.disabled = true;
    resultSec.classList.add('hidden');
    
    // Pick random funny text translated to current language
    const funnyArray = translations[currentLang].funnyTexts;
    loadingText.innerText = funnyArray[Math.floor(Math.random() * funnyArray.length)];
    loadingText.classList.remove('hidden');

    currentFood = availableFood[Math.floor(Math.random() * availableFood.length)];

    setTimeout(() => {
        loadingText.classList.add('hidden');
        btn.disabled = false;
        showResultUI("");
    }, 800);
});

function showResultUI(customTitlePrefix) {
    const locFood = currentFood.translations[currentLang]; // Use Current Language!
    
    document.getElementById('result').classList.remove('hidden');
    document.querySelector('.welcome-text').style.display = 'none';
    document.querySelector('.seo-intro').style.display = 'none';
    
    document.getElementById('foodEmoji').innerText = currentFood.emoji;
    document.getElementById('foodName').innerText = customTitlePrefix + locFood.name;
    document.getElementById('foodOrigin').innerText = `üåç ${locFood.origin}`;
    
    const diffBadge = document.getElementById('foodDifficulty');
    diffBadge.innerText = locFood.difficulty.toUpperCase();
    diffBadge.className = 'badge ' + currentFood.difficultyCSS; 
    
    document.getElementById('foodCost').innerText = locFood.cost;
    document.getElementById('foodDesc').innerText = locFood.description;
    
    setTimeout(() => document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
}

// --- RECIPE MODAL LOGIC ---
window.openRecipeDetails = function(mode) {
    if (!currentFood) return;
    const r = currentFood.translations[currentLang][mode]; 
    const t = translations[currentLang];

    document.getElementById('modalTitle').innerText = mode === 'simple' ? t.lazyMode : t.chefMode;
    document.getElementById('timeVal').innerText = r.time;
    document.getElementById('tempVal').innerText = r.temp;
    
    document.getElementById('modalIngredients').innerHTML = '';
    r.ingredients.forEach(i => document.getElementById('modalIngredients').innerHTML += `<li>${i}</li>` );
    
    document.getElementById('modalSteps').innerHTML = '';
    r.steps.forEach(s => document.getElementById('modalSteps').innerHTML += `<li>${s}</li>` );
    
    document.getElementById('recipeModal').classList.remove('hidden');
};

window.closeRecipeDetails = function() {
    document.getElementById('recipeModal').classList.add('hidden');
};
